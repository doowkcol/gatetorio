==========================================
Gatetorio BLE Server
==========================================
Starting at: Sun 16 Nov 09:54:19 GMT 2025

==========================================
Gatetorio BLE Server Startup
==========================================

Step 1: Checking for existing gate controller instances...
[0;32mâœ“ No existing controller instances found[0m

Step 2: Cleaning Bluetooth state...
  Restarting Bluetooth service...
[0;32mâœ“ Bluetooth service is running[0m

Step 3: Checking Bluetooth adapter...
[0;32mâœ“ Bluetooth adapter UP: hci0:	Type: Primary  Bus: UART[0m

Step 4: Starting BLE server...
==========================================

[Main] Initializing Gatetorio gate controller...
[Main] WARNING: Make sure no other controller instance is running!
[Main] Close the desktop launcher before starting BLE server.

[Main] Step 1: Waiting for hardware initialization...
[Main] Step 2: Creating controller instance...
Gate Controller V2 (Step 3 - Three Processes) initialized
  M1 travel time: 7.835115489037847s, M2 travel time: 8.557032567378949s
  M2 enabled: True
  Motor Manager PID: 28063
  Input Manager PID: 28064
  Auto-close: ENABLED (5.0s)
Motor Manager initialized
Motor Manager process started
Input Manager: ADC1 initialized at address 0x48 (ADDR->GND)
Input Manager: ADC2 initialized at address 0x49 (ADDR->VDD)
Input Manager: 2 ADC(s) initialized successfully (8 channels available)
Input Manager initialized:
  Inputs configured: 8
  Sample rate: 0.1s (10.0Hz)
  ADC available: True
  Channels available: 8
Input Manager: Starting main loop

================================================================================
CONFIGURED INPUTS (8 total):
================================================================================
  IN1                  Ch= 0 Type=NC  Func=close_limit_m1       [ENABLED]
  IN2                  Ch= 1 Type=NO  Func=open_limit_m1        [ENABLED]
  IN3                  Ch= 2 Type=NO  Func=open_limit_m2        [ENABLED]
  IN4                  Ch= 3 Type=NC  Func=close_limit_m2       [ENABLED]
  IN5                  Ch= 4 Type=NO  Func=cmd_open             [ENABLED]
  IN6                  Ch= 5 Type=8K2 Func=safety_stop_opening  [ENABLED]
  IN7                  Ch= 6 Type=NO  Func=None                 [ENABLED]
  IN8                  Ch= 7 Type=NO  Func=None                 [ENABLED]
================================================================================

[INPUT RAW] IN1                  func=close_limit_m1       raw=ACTIVE was=inactive V=0.00
[INPUT DEBOUNCED] IN1                  func=close_limit_m1       â†’ ACTIVE
[INPUT RAW] IN4                  func=close_limit_m2       raw=ACTIVE was=inactive V=0.00
[INPUT DEBOUNCED] IN4                  func=close_limit_m2       â†’ ACTIVE
[STARTUP] Detected gate at CLOSED position (both motors at close limits)
[Main] Step 3: Waiting for input manager to stabilize (5 seconds)...
[Main]   This allows ADC readings to settle before safety checks
[Main] Step 4: Verifying input readings...
[Main]   âœ“ Inputs stable - safety system nominal
[Main] âœ“ Controller initialized and stable

[Main] Initializing BLE server...
[BLE] Initialized - Hardware ID: 98697DF6
[BLE] User ID: gatetorio-default
[Main] Starting BLE GATT server...
============================================================
Gatetorio BLE Server v1.0.0 (localGATT)
============================================================
Hardware ID: 98697DF6
User ID: gatetorio-default
[BLE] TESTING MODE: Pairing window ALWAYS OPEN
[BLE] Device will be discoverable as: Gatetorio-7DF6
============================================================
Gatetorio BLE Server - localGATT Implementation
============================================================
[BLE] Using adapter: 2C:CF:67:A4:C4:D0
[BLE] Creating GATT application...
[BLE] Adding Gate Control service (PRIMARY)...
[BLE] ERROR: Unknown format code 'd' for object of type 'str'
Traceback (most recent call last):
  File "/home/doowkcol/Gatetorio_Code/ble_server_localgatt.py", line 233, in start_localgatt_server
    cmd_tx_char = CommandTxChar(1, gate_service, ble_server)
  File "/home/doowkcol/Gatetorio_Code/ble_server_localgatt.py", line 36, in __init__
    super().__init__(
    ~~~~~~~~~~~~~~~~^
        index,
        ^^^^^^
    ...<4 lines>...
        ['write']
        ^^^^^^^^^
    )
    ^
  File "/usr/local/lib/python3.13/dist-packages/bluezero/localGATT.py", line 236, in __init__
    self.path = f'{service_path}/char{characteristic_id:04d}'
                                     ^^^^^^^^^^^^^^^^^^^^^^^
ValueError: Unknown format code 'd' for object of type 'str'
Process Process-2:
Exception in thread Thread-2 (_control_loop):
Traceback (most recent call last):
Traceback (most recent call last):
Process Process-3:
  File "/usr/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
    ~~~~~~~~^^
  File "/usr/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/doowkcol/Gatetorio_Code/gate_controller_v2.py", line 405, in _control_loop
    self._evaluate_commands(now)
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "/home/doowkcol/Gatetorio_Code/gate_controller_v2.py", line 664, in _evaluate_commands
    if self.shared['deadman_open_active'] or self.shared['deadman_close_active']:
                                             ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in __getitem__
  File "/usr/lib/python3.13/multiprocessing/managers.py", line 831, in _callmethod
    kind, result = conn.recv()
                   ~~~~~~~~~^^
  File "/usr/lib/python3.13/multiprocessing/connection.py", line 250, in recv
    buf = self._recv_bytes()
  File "/usr/lib/python3.13/multiprocessing/connection.py", line 430, in _recv_bytes
    buf = self._recv(4)
  File "/usr/lib/python3.13/multiprocessing/connection.py", line 395, in _recv
    chunk = read(handle, remaining)
ConnectionResetError: [Errno 104] Connection reset by peer
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/doowkcol/Gatetorio_Code/motor_manager.py", line 1832, in motor_manager_process
    manager.run()
    ~~~~~~~~~~~^^
  File "/home/doowkcol/Gatetorio_Code/motor_manager.py", line 341, in run
    self._process_limit_switches(now)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "/home/doowkcol/Gatetorio_Code/motor_manager.py", line 1069, in _process_limit_switches
    if self.motor2_use_limit_switches and self.shared.get('open_limit_m2_active', False):
                                          ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in get
  File "/usr/lib/python3.13/multiprocessing/managers.py", line 831, in _callmethod
    kind, result = conn.recv()
                   ~~~~~~~~~^^
  File "/usr/lib/python3.13/multiprocessing/connection.py", line 250, in recv
    buf = self._recv_bytes()
  File "/usr/lib/python3.13/multiprocessing/connection.py", line 430, in _recv_bytes
    buf = self._recv(4)
  File "/usr/lib/python3.13/multiprocessing/connection.py", line 395, in _recv
    chunk = read(handle, remaining)
ConnectionResetError: [Errno 104] Connection reset by peer
Traceback (most recent call last):

==========================================
BLE server stopped
==========================================
